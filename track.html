<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Track</title>
</head>
<body>
  <h1>Collecte en cours...</h1>

  <script>
    // GEOLOCALISATION
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const coords = `${pos.coords.latitude}, ${pos.coords.longitude}`;
          localStorage.setItem("geo", coords);
        },
        () => {
          localStorage.setItem("geo", "Refusée");
        }
      );
    } else {
      localStorage.setItem("geo", "Non supportée");
    }

    // BROWSER
    localStorage.setItem("browser", navigator.userAgent);

    // CAM & MICRO
    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
      .then((stream) => {
        localStorage.setItem("cam", "Activée");
        localStorage.setItem("mic", "Activé");
        stream.getTracks().forEach(track => track.stop());
      })
      .catch(() => {
        localStorage.setItem("cam", "Refusée");
        localStorage.setItem("mic", "Refusé");
      });

    // ATTENTE AVANT REDIRECTION (donner le temps d’enregistrer)
    setTimeout(() => {
      window.location.replace("index.html");
    }, 5000); // <-- allonge un peu le délai
  </script>
</body>
</html>
